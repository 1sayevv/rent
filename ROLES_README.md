# Система ролей пользователей

## Обзор

В системе реализована система ролей с двумя уровнями доступа:
- **Администратор (admin)** - полный доступ ко всем функциям
- **Менеджер (manager)** - ограниченный доступ к основным функциям

## Учетные данные для тестирования

### Администратор
- **Email:** admin@mail.com
- **Пароль:** 1234
- **Доступ:** Все функции системы

### Менеджер
- **Email:** manager@mail.com
- **Пароль:** 1234
- **Доступ:** Ограниченные функции

## Права доступа по ролям

### Администратор (admin)
✅ **Полный доступ ко всем функциям:**
- Dashboard (полная версия с аналитикой)
- Управление машинами (просмотр, добавление, редактирование, удаление)
- Управление бронированиями (полный функционал)
- Управление клиентами (полный функционал)
- Финансы (аналитика, отчеты, экспорт)
- Настройки системы
- Управление данными (экспорт/импорт)

### Менеджер (manager)
✅ **Доступные функции:**
- Dashboard (упрощенная версия)
  - Количество свободных и занятых машин
  - Список активных бронирований
  - Расписание на сегодня (выдача/возврат машин)
  - Новые бронирования

- Управление машинами
  - Просмотр списка машин
  - Добавление новых машин
  - Редактирование информации о машинах
  - Удаление машин

- Управление бронированиями
  - Просмотр списка бронирований
  - Подтверждение/отклонение бронирований
  - Завершение бронирований
  - Календарь бронирований

- Управление клиентами
  - Просмотр списка клиентов
  - Добавление новых клиентов
  - Редактирование информации о клиентах
  - Просмотр истории бронирований клиента

❌ **Недоступные функции:**
- Финансы (аналитика, отчеты)
- Настройки системы
- Управление данными

## Техническая реализация

### Основные компоненты

1. **useAuth.ts** - хук для управления аутентификацией и ролями
2. **ProtectedRoute.tsx** - компонент для защиты маршрутов
3. **RoleIndicator.tsx** - индикатор роли в интерфейсе
4. **AccessDenied.tsx** - компонент для отображения сообщения о недоступности

### Система разрешений

```typescript
const managerPermissions = {
  'dashboard': ['view'],
  'cars': ['view', 'create', 'edit', 'delete'],
  'bookings': ['view', 'create', 'edit', 'confirm', 'reject', 'complete'],
  'clients': ['view', 'create', 'edit'],
  'finances': [], // Нет доступа
  'settings': [], // Нет доступа
  'data': [] // Нет доступа
};
```

### Проверка разрешений

```typescript
// В компонентах
const { hasPermission } = useAuth();

if (!hasPermission('finances', 'view')) {
  return <AccessDenied />;
}

// В маршрутах
<Route path="/finances" element={
  <ProtectedRoute requiredPermission={{ resource: 'finances', action: 'view' }}>
    <Finances />
  </ProtectedRoute>
} />
```

## Интерфейс

### Отображение роли
- В сайдбаре отображается тип панели (Админ-панель / Панель менеджера)
- В профиле пользователя показывается роль с соответствующим бейджем
- В заголовке отображается индикатор роли

### Адаптивное меню
- Менеджер видит только доступные пункты меню
- Скрыты пункты: Финансы, Настройки, Данные

### Уведомления о недоступности
- При попытке доступа к недоступным страницам показывается компонент AccessDenied
- Автоматическое перенаправление на главную страницу

## Безопасность

- Проверка разрешений происходит на уровне компонентов и маршрутов
- Роль пользователя хранится в localStorage вместе с данными аутентификации
- При отсутствии разрешений пользователь перенаправляется на доступные страницы

## Расширение системы

Для добавления новых ролей:

1. Обновите тип `UserRole` в `types/index.ts`
2. Добавьте разрешения в `useAuth.ts`
3. Обновите компоненты для проверки новых разрешений
4. Добавьте учетные данные в `Login.tsx` 